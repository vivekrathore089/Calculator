<script>
function calculate() {
  let balance = parseFloat(document.getElementById("balance").value);
  let riskPercent = parseFloat(document.getElementById("risk").value) / 100;
  let slPoints = parseFloat(document.getElementById("slPoints").value);
  let pipValue = parseFloat(document.getElementById("pipValue").value); // 1 lot pip value (EURUSD = 10)
  let spreadPoints = parseFloat(document.getElementById("spreadPoints").value);

  const outputDiv = document.getElementById("output");

  if (
    isNaN(balance) ||
    isNaN(riskPercent) ||
    isNaN(slPoints) ||
    isNaN(pipValue) ||
    isNaN(spreadPoints)
  ) {
    outputDiv.style.display = "block";
    outputDiv.style.borderLeftColor = "#ff4d4d";
    outputDiv.innerHTML = "<center>‚ùå INPUT DATA INCOMPLETE</center>";
    return;
  }

  // Risk money
  let riskAmount = balance * riskPercent;

  // SL adjusted for spread (POINTS)
  let totalSlPoints = slPoints + spreadPoints;

  // EURUSD: 10 points = 1 pip
  let pointValuePerLot = pipValue / 10;

  // Lot size calculation (POINTS only)
  let lotSize = riskAmount / (totalSlPoints * pointValuePerLot);

  // TRUE 1:3 RR based on adjusted SL
  let tpPoints = totalSlPoints * 3;

  // Expected reward
  let expectedProfit = tpPoints * pointValuePerLot * lotSize;

  outputDiv.style.display = "block";
  outputDiv.style.borderLeftColor = "var(--neon-blue)";
  outputDiv.innerHTML = `
    <div class="res-row"><span>Risk Amount:</span> <b>$${riskAmount.toFixed(2)}</b></div>
    <div class="res-row"><span>Lot Size:</span> <b class="highlight">${lotSize.toFixed(2)}</b></div>
    <div class="res-row"><span>Total SL:</span> <b>${totalSlPoints} pts</b></div>
    <div class="res-row"><span>TP (1:3):</span> <b>${tpPoints} pts</b></div>
    <div class="res-row" style="border:none; margin-top:10px;">
      <span>Potential Reward:</span> <b class="highlight">$${expectedProfit.toFixed(2)}</b>
    </div>
  `;
}
</script>